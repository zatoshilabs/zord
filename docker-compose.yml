version: '3.8'

services:
  zord:
    build: .
    container_name: zord-indexer
    ports:
      - "${PORT:-8080}:${API_PORT:-8080}"
    volumes:
      - zord-data:/data
    environment:
      # RPC Configuration
      ZCASH_RPC_URL: ${ZCASH_RPC_URL}
      ZCASH_RPC_USERNAME: ${ZCASH_RPC_USERNAME}
      ZCASH_RPC_PASSWORD: ${ZCASH_RPC_PASSWORD}

      # Indexing
      ZSTART_HEIGHT: ${ZSTART_HEIGHT:-3132356}

      # ZMQ (Optional)
      ZMQ_URL: ${ZMQ_URL:-}

      # API
      API_PORT: ${API_PORT:-8080}
      DB_PATH: /data/zord.db

      # Logging
      RUST_LOG: ${RUST_LOG:-info}

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${API_PORT:-8080}/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  zord-data:
    driver: local
