<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Zord · Names</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <header class="bar">
        <nav>
            <a href="/">inscriptions</a>
            <a href="/tokens">zrc-20</a>
            <a href="/names/zec">names.zec</a>
            <a href="/names/zcash">names.zcash</a>
            <a href="/docs">docs</a>
            <a href="/spec">api</a>
        </nav>
        <zord-status></zord-status>
    </header>

    <main>
        <section class="search">
            <input type="text" id="name-search" placeholder="filter names" autocomplete="off">
        </section>
        <section class="search" style="display:flex; gap:8px; align-items:center;">
            <input type="text" id="resolver-input" placeholder="resolve name (e.g. alice.zec)" autocomplete="off">
            <button id="resolver-button">resolve</button>
            <span id="resolver-result" class="notes"></span>
        </section>
        <name-table page-size="120" id="name-list"></name-table>
    </main>

    <sync-footer></sync-footer>

    <script type="module" src="/static/app.js"></script>
    <script>
        const input = document.getElementById('name-search');
        const table = document.getElementById('name-list');
        let timer;
        input.addEventListener('input', (event) => {
            clearTimeout(timer);
            timer = setTimeout(() => {
                table.setAttribute('search-query', event.target.value.trim());
            }, 200);
        });

        async function resolveName(name) {
            const result = document.getElementById('resolver-result');
            result.textContent = '…';
            try {
                const q = name.trim();
                if (!q || (!q.endsWith('.zec') && !q.endsWith('.zcash'))) {
                    result.textContent = 'enter a .zec or .zcash name';
                    return;
                }
                const res = await fetch(`/resolve/${encodeURIComponent(q)}`);
                if (!res.ok) { result.textContent = 'not found'; return; }
                const data = await res.json();
                if (data && data.address) {
                    result.textContent = data.address;
                } else {
                    result.textContent = 'not found';
                }
            } catch (e) {
                result.textContent = 'error resolving';
            }
        }

        const resolverInput = document.getElementById('resolver-input');
        const resolverButton = document.getElementById('resolver-button');
        resolverButton.addEventListener('click', () => resolveName(resolverInput.value));
        resolverInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') resolveName(resolverInput.value);
        });
    </script>
</body>
</html>
